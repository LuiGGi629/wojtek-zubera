<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Python Environment for Data Science | Wojtek Zubera</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Python Environment for Data Science" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="An oppinionated way to package python projects properly with poetry" />
<meta property="og:description" content="An oppinionated way to package python projects properly with poetry" />
<link rel="canonical" href="https://luiggi629.github.io/wojtek-zubera/poetry/" />
<meta property="og:url" content="https://luiggi629.github.io/wojtek-zubera/poetry/" />
<meta property="og:site_name" content="Wojtek Zubera" />
<meta property="og:image" content="https://luiggi629.github.io/wojtek-zubera/poetry_pyenv_imgs/precommit_pipeline.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-08T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"An oppinionated way to package python projects properly with poetry","@type":"BlogPosting","headline":"Python Environment for Data Science","url":"https://luiggi629.github.io/wojtek-zubera/poetry/","datePublished":"2020-09-08T00:00:00-05:00","dateModified":"2020-09-08T00:00:00-05:00","image":"https://luiggi629.github.io/wojtek-zubera/poetry_pyenv_imgs/precommit_pipeline.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://luiggi629.github.io/wojtek-zubera/poetry/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/wojtek-zubera/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://luiggi629.github.io/wojtek-zubera/feed.xml" title="Wojtek Zubera" /><link rel="shortcut icon" type="image/x-icon" href="/wojtek-zubera/images/favicon.ico"><link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/wojtek-zubera/">Wojtek Zubera</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/wojtek-zubera/about/">About me</a><a class="page-link" href="/wojtek-zubera/search/">Search</a><a class="page-link" href="/wojtek-zubera/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Python Environment for Data Science</h1><p class="page-description">An oppinionated way to package python projects properly with poetry</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-09-08T00:00:00-05:00" itemprop="datePublished">
        Sep 8, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#shell">shell</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#git">git</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#git-hooks">git-hooks</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#poetry">poetry</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#pyenv">pyenv</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#black">black</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#mypy">mypy</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#flake8">flake8</a>
        &nbsp;
      
        <a class="category-tags-link" href="/wojtek-zubera/categories/#isort">isort</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/LuiGGi629/wojtek-zubera/tree/master/_notebooks/2020-09-08-poetry-pyenv.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/wojtek-zubera/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Python-Environment">Python Environment </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Interpreter">Interpreter </a></li>
<li class="toc-entry toc-h2"><a href="#Dependency-Management-via-poetry">Dependency Management via poetry </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Consistent-Formatting-and-Readability">Consistent Formatting and Readability </a></li>
<li class="toc-entry toc-h3"><a href="#mypy-Type-Correctness">mypy Type-Correctness </a></li>
<li class="toc-entry toc-h3"><a href="#Isort">Isort </a></li>
<li class="toc-entry toc-h3"><a href="#Pre-commit">Pre-commit </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Results">Results </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-09-08-poetry-pyenv.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Python-Environment">
<a class="anchor" href="#Python-Environment" aria-hidden="true"><span class="octicon octicon-link"></span></a>Python Environment<a class="anchor-link" href="#Python-Environment"> </a>
</h1>
<h2 id="Interpreter">
<a class="anchor" href="#Interpreter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interpreter<a class="anchor-link" href="#Interpreter"> </a>
</h2>
<p>If you have programs that require different python versions or programs that depend on different versions of the same third-party module and you want to switch between those programs seamlessly?</p>
<blockquote>
<p>Pyenv will help you doing that!</p>
</blockquote>
<p>You can install Pyenv by</p>
<div class="highlight"><pre><span></span>curl https://pyenv.run <span class="p">|</span> bash
</pre></div>
<p>After that, add the following lines to your .bashrc (same for .zshrc) to have pyenv available in your terminal</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">"~/.pyenv/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="k">$(</span>pyenv init -<span class="k">)</span><span class="s2">"</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="k">$(</span>pyenv virtualenv-init -<span class="k">)</span><span class="s2">"</span>
</pre></div>
<p>I had to restart my terminal afterwards</p>
<p>On Ubuntu install the following ones to not run into problems</p>
<div class="highlight"><pre><span></span>sudo apt-get install build-essential libsqlite3-dev sqlite3 bzip2 libbz2-dev zlib1g-dev libssl-dev openssl libgdbm-dev libgdbm-compat-dev liblzma-dev libreadline-dev libncursesw5-dev libffi-dev uuid-dev
</pre></div>
<p>Now, to install a python interpreter just do</p>
<div class="highlight"><pre><span></span>pyenv install VERSION_YOU_WOULD_LIKE_TO_INSTALL
</pre></div>
<p>You can list out all versions available via pyenv</p>
<div class="highlight"><pre><span></span>pyenv install --list
</pre></div>
<p>To make it concrete, let’s install python 3.8.2 and make it your default global-interpreter</p>
<div class="highlight"><pre><span></span>pyenv install <span class="m">3</span>.8.2
</pre></div>
<div class="highlight"><pre><span></span>pyenv global <span class="m">3</span>.8.2
</pre></div>
<h2 id="Dependency-Management-via-poetry">
<a class="anchor" href="#Dependency-Management-via-poetry" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dependency Management via <a href="https://python-poetry.org/">poetry</a><a class="anchor-link" href="#Dependency-Management-via-poetry"> </a>
</h2>
<p>The way the authors recommend installing poetry is</p>
<div class="highlight"><pre><span></span>curl -sSL https://raw.githubusercontent.com/sdispater/poetry/master/get-poetry.py <span class="p">|</span> python
</pre></div>
<p>Another way is using pip and pyenv-virtualenv.</p>
<p>Create a virtual environment called tools that is based on 3.8.2</p>
<div class="highlight"><pre><span></span>pyenv virtualenv <span class="m">3</span>.8.2 tools
</pre></div>
<p>Install poetry into the tools virtual env</p>
<div class="highlight"><pre><span></span>pyenv activate tools
</pre></div>
<div class="highlight"><pre><span></span>python -m pip install poetry
</pre></div>
<p>Check installed poetry version</p>
<div class="highlight"><pre><span></span>poetry --version
</pre></div>
<p>Leave the virtual env</p>
<div class="highlight"><pre><span></span>pyenv deactivate
</pre></div>
<p>Add your tools virtual env to the globally available ones</p>
<div class="highlight"><pre><span></span>pyenv global <span class="m">3</span>.8.2 tools
</pre></div>
<p>I had to restart my terminal afterwards</p>
<p>You can start using poetry</p>
<div class="highlight"><pre><span></span>poetry --version
</pre></div>
<p>Before using poetry I recommend configuring it, such that it creates your project’s virtual environment in a .venv folder inside the project directory.</p>
<div class="highlight"><pre><span></span>poetry config virtualenvs.in-project <span class="nb">true</span>
</pre></div>
<p>Initialze a new project</p>
<div class="highlight"><pre><span></span>poetry new ml-project
<span class="nb">cd</span> ml-project
</pre></div>
<p>Add modules and create virtual environment.</p>
<div class="highlight"><pre><span></span>poetry add pandas --extras all
</pre></div>
<h3 id="Consistent-Formatting-and-Readability">
<a class="anchor" href="#Consistent-Formatting-and-Readability" aria-hidden="true"><span class="octicon octicon-link"></span></a>Consistent Formatting and Readability<a class="anchor-link" href="#Consistent-Formatting-and-Readability"> </a>
</h3>
<p>We add black as a development dependency with --dev as we don't
need it when it comes to production</p>
<div class="highlight"><pre><span></span>poetry add --dev black
</pre></div>
<p>I’d rather maintain the recommended 79 character length. I just need to configure my <em>pyproject.toml</em> to <em>line-length=79</em> and everything is all set. Here’s my <em>.toml</em> file for configuring black:</p>

<pre><code>[tool.black]
line-length = 79
include = '\.pyi?$'
exclude = '''
/(
    \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | _build
  | buck-out
  | build
  | dist
)/
'''</code></pre>
<div class="highlight"><pre><span></span>poetry add --dev flake8
</pre></div>
<p>Insight of your project's dependencies</p>
<div class="highlight"><pre><span></span>poetry show --tree
poetry show --latest
</pre></div>
<p>In order for black to work nicely with <a href="https://flake8.pycqa.org/en/latest/">flake8</a>, we need to list down some error codes to ignore. <em>tox.ini</em> configuration below:</p>
<div class="highlight"><pre><span></span>touch tox.ini .
</pre></div>

<pre><code># Flake8 Configuration
[flake8]
ignore = E203, D203, E266, E501, W503, F403, F401
exclude =
    .tox,
    .git,
    __pycache__,
    docs/source/conf.py,
    build,
    dist,
    tests/fixtures/*,
    *.pyc,
    *.egg-info,
    .cache,
    .eggs
max-line-length = 79
max-complexity = 18
select = B,C,E,F,W,T4,B9
format = ${cyan}%(path)s${reset}:${yellow_bold}%(row)d${reset}:${green_bold}%(col)d${reset}: ${red_bold}%(code)s${reset} %(text)s</code></pre>
<h3 id="mypy-Type-Correctness">
<a class="anchor" href="#mypy-Type-Correctness" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://mypy.readthedocs.io/en/stable/">mypy</a> Type-Correctness<a class="anchor-link" href="#mypy-Type-Correctness"> </a>
</h3>
<p>Through type annotations, your code becomes better to understand, maintain, and less prone to errors. Why less prone to errors? Because you can statically check if the types of your variables and functions match the expected ones.</p>
<div class="highlight"><pre><span></span>poetry add --dev mypy
</pre></div>
<p>Running mypy might create a lot of errors. You can configure it to only warn you about the things you are interested in. You do that by adding a mypy.ini file to your project and refer to the <a href="https://mypy.readthedocs.io/en/latest/config_file.html">documentation</a> for more details.</p>
<h3 id="Isort">
<a class="anchor" href="#Isort" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/PyCQA/isort">Isort</a><a class="anchor-link" href="#Isort"> </a>
</h3>
<p>Isort is a Python utility / library to sort imports alphabetically, and automatically separated into sections and by type.</p>
<div class="highlight"><pre><span></span>poetry add --dev isort
</pre></div>
<h3 id="Pre-commit">
<a class="anchor" href="#Pre-commit" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://pre-commit.com/">Pre-commit</a><a class="anchor-link" href="#Pre-commit"> </a>
</h3>
<p>Pre-commit is a tool that executes checks before you commit code to your repository. When those checks fail, your commit will be rejected. With that, your repository will never see not formatted code, or none type-checked one, or anything else depending on the checks you are going to include.</p>
<p>You can either install it directly into your project using <a href="https://python-poetry.org/docs/">poetry</a> or install it on your local machine. I prefer the latter, as pre-commit is only used locally and not on a CI/CD server. In contrast, black and mypy should run on a CI/CD server, thus, it makes sense to add them to the project’s dev dependencies. Here is how one could install it making use of the already existing tool virtual environment.</p>
<p>Install pre-commit into the tools virtual env</p>
<div class="highlight"><pre><span></span>pyenv activate tools
</pre></div>
<div class="highlight"><pre><span></span>python -m pip install pre-commit
</pre></div>
<div class="highlight"><pre><span></span>pyenv deactivate
</pre></div>
<div class="highlight"><pre><span></span>pre-commit --version
</pre></div>
<p>To use it, you first need to add a config file called <em>.pre-commit-config.yaml</em> to the top-level folder of your project. In that file, you configure all the hooks that should run.</p>
<div class="highlight"><pre><span></span>touch .pre-commit-config.yaml .
</pre></div>

<pre><code>repos:
    -   repo: https://github.com/psf/black
        rev: 20.8b1
        hooks:
        - id: black
          language_version: python3.8
    -   repo: https://github.com/pre-commit/mirrors-mypy
        rev: v0.782
        hooks:
        - id: mypy
    -   repo: https://gitlab.com/pycqa/flake8
        rev: 3.8.3  # pick a git hash / tag to point to
        hooks:
        - id: flake8
    -   repo: https://github.com/pycqa/isort
        rev: 5.5.1
        hooks:
        - id: isort</code></pre>
<p>In the top level folder run</p>
<div class="highlight"><pre><span></span>pre-commit install
</pre></div>
<p>It is recommended to manually run pre-commit on all files as is it only touches the files that have been changed since the last commit.</p>
<div class="highlight"><pre><span></span>pre-commit run --all --show-diff-on-failure
</pre></div>
<p>Now, the hooks will run on every commit. The black hook will not only check for formatting issues but also format the files accordingly. Whenever you add a new hook, so also at the very beginning, it is recommended to manually run pre-commit on all files as is it only touches the files that have been changed since the last commit</p>
<h1 id="Results">
<a class="anchor" href="#Results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Results<a class="anchor-link" href="#Results"> </a>
</h1>
<p><img src="/wojtek-zubera/images/copied_from_nb/poetry_pyenv_imgs/precommit_pipeline.png" alt=""></p>
<p>So what we have is a pipeline that safeguards project against wrongly-formatted code — now we can focus on content.</p>
<p><strong>Credits to</strong>:</p>
<ul>
<li><a href="https://towardsdatascience.com/how-to-setup-an-awesome-python-environment-for-data-science-or-anything-else-35d358cc95d5">Simon Hawe</a></li>
<li><a href="https://ljvmiranda921.github.io/notebook/2018/06/21/precommits-using-black-and-flake8/">LJ MIRANDA</a></li>
</ul>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="LuiGGi629/wojtek-zubera"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/wojtek-zubera/poetry/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/wojtek-zubera/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/wojtek-zubera/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/wojtek-zubera/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>People and communication skills are crucial.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/luiggi629" title="luiggi629"><svg class="svg-icon grey"><use xlink:href="/wojtek-zubera/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
